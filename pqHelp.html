<!--
__version__ = "0.1.0" # refer to PEP-0008
__author__  = "David Cortesi"
__copyright__ = "Copyright 2011, 2012 David Cortesi"
__maintainer__ = "?"
__email__ = "tallforasmurf@yahoo.com"
__status__ = "first-draft"
__license__ = '''
 License (GPL-3.0) :
    This file is part of PPQT.
    PPQT is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You can find a copy of the GNU General Public License in the file
    extras/COPYING.TXT included in the distribution of this program, or see:
    <http://www.gnu.org/licenses/>.
'''
-->
<html>
<head>
</head>
<body>
<h1>Introduction</h1>
<p>PPQT is a unified tool for post-processing books for Project Gutenberg Distributed Proofreaders. It provides a text editor that integrates a number of features useful during post-processing, including display of the book's scanned pages, regular expression find/replace, spellcheck, pagination, footnoting, and html preview. This Help is its sole documentation.</p>
<h2>Mac Users Note</h2>
<p> Throughout this Help, when you read <b>ctl-</b>
you think <b>cmd-</b>. And when you read <b>alt-</b>, you think <b>opt-</b>.
Qt is quite consistent in these mappings. However, when you see <b>control-</b>
(not <b>ctl-</b>), that really means, the Control key on every platform.</p>
<p>For example, this help says that to set bookmark 1, you key ctl-alt-1. However as a Mac user you will  know to substitute cmd- for ctl- and opt- for alt-, and set bookmark 1 using cmd-opt-1. Try it now: key ctl-f for a simple Find dialog for searching in this help text.</p>
<h2>Licenses</h2>
<p>PPQT is based on the <a href="http://qt-project.org">Qt platform</a>.
It is coded in Python using <a href="http://riverbankcomputing.co.uk/software/pyqt/intro">PQt4</a>.
It is packaged for distribution using <a href="http://pyinstaller.org">pyinstaller</a>.</p>
<p>Qt is licensed for noncommercial use under the LGPL.
PyQt4 is licensed for noncommercial use under the GPL v2 and the GPL v3.
The source code of PPQT is licensed under the GPL v3; see the file <tt>extras/COPYING.TXT</tt> in the distribution folder.</p>
<h2>Acknowledgements</h2>
<p>First, a deep bow of respect to Steve Shulz (Thundergnat) who created and maintained Guiguts, the program from which PPQT takes its inspiration and lots of ideas. Second, a genuflection  to Mark Summerfield for the book <i>Rapid GUI Developement with PyQt</i> that showed how to build PPQT.</p>
<h2>Contents</h2>
<ul>
<li><a href='#Files'>Files and Folders</a> says where PPQT looks for the book text, images, and related files.</li>
<li><a href='#Main'>The Main Window</a> describes that.</li>
<li><a href='#Edit'>The Edit Panel</a> tells about selecting text and the use of many special keys.</li>
<li><a href='#Scannos'>Scanno Highlighting</a> tells how to make "scannos" visible.</li>
<li><a href='#Spellcheck'>Spellcheck</a> explains the use of good and bad words files and spelling dictionaries.</li>
<li><a href='#Pngs'>The Pngs Panel</a> tells how to display scan images.</li>
<li><a href='#Notes'>The Notes Panel</a> tells how to make notes that are saved with the book metadata.</li>
<li><a href='#Find'>The Find Panel</a> tells about the many Find and Replace facilities.</li>
<li><a href='#Chars'>The Characters Panel</a> tells how to use the character census.</li>
<li><a href='#Words'>The Words Panel</a> tells how to find words, similar words, and misspelt words.</li>
<li><a href='#Pages'>The Pages Panel</a> tells how to paginate the HTML etext.</li>
<li><a href='#Flow'>The Reflow Panel</a> tells how to mark-up the text for format, and how to format the ASCII and HTML etexts</li>
<li><a href='#View'>The Preview Panel</a> tells how to preview the HTML conversion.</li>
<li><a href='#Foot'>The Footnote Panel</a> tells how to find, number and convert footnotes.</li>
</ul>
<h2 id='Files'>Files and Folders</h2>
<p>PPQT edits one book text at a time, for example <tt>afinebook.txt</tt>. 
<h3>File Encodings and Suffixes</h3>
<p>PPQT is entirely Unicode internally. The file contents are converted to Unicode on input, and back to some byte code on output, based only on the file suffix. Rename a new file as needed to cause conversion to and from these encodings:</p>
<table border='1' style='border-collapse:collapse;'>
<head><td>Suffix</td><td>Uses encoding</td></head>
<tr><td style='width:4em;'><tt>.txt</tt></td><td>Latin-1 or 7-bit Ascii (PPQT cannot distinguish between these)</td></tr>
<tr><td><tt>.utf</tt></td><td>UTF-8 encoding of Unicode, preferred for text with non-latin characters</td></tr>
<tr><td><tt>.win</tt></td><td>Windows code page 1252, the US and European Windows alphabet.</td></tr>
<tr><td><tt>.mac</tt></td><td>Mac Roman, the Apple alphabet.</td></tr>
<tr><td><tt>.isr</tt></td><td>Windows code page 1255, Windows Hebrew</td></tr> <tr><td><tt>.cyr</tt></td><td>Windows code page 1251, Windows Cyrillic alphabet.</td></tr>
<tr><td><tt>.kir</tt></td><td>KOI8-R, Cyrillic-Russian.</td></tr>
<tr><td><tt>.kiu</tt></td><td>KOI8-U, Cyrillic-Ukranian.</td></tr>
</table>
<p>It is best to save to <tt>.utf</tt> if there is any chance the text contains non-Latin-1 characters; prefer <tt>.txt</tt> when you are sure it is pure  Latin-1 or ASCII.</p>
<h3>Metadata</h3>
When opening  <tt>afinebook.txt</tt>, PPQT looks for a file named  <tt>afinebook.txt.meta</tt> in the same location (i.e. the full book name
plus <tt>.meta</tt>). If the meta file
is not found, PPQT assumes this is the first time it has opened this book.
It scans the text gathering information including the location of page separator lines, and counting words and characters. These metadata will be stored in the <tt>.meta</tt> file when the file is saved. When the <tt>.meta</tt> file does
exist, PPQT loads the metadata items from it.</p>
<p>Feel free to examine or edit the metadata file, but be aware that it is written in UTF-8 format. If strange characters appear, your editor app did not use the utf-encoding to load it. Do not save the metadata file unless you are sure you are loading and saving it in UTF-8 format.</p>
<h3>Page Images</h3>
<p>PPQT expects to find a folder named <tt>pngs</tt> in the same location as
the text file, containing the scan images for the book. These are displayed in 
the Pngs panel.</p>
<h2 id='Main'>The Main Window</h2>
<p>When launched, PPQT displays a single window divided in two by a vertical bar. The left side is the Edit Panel where you edit the document. The right side
is a tabbed set of panels for different functions. All these panels are described below.</p>
<p>You can adjust the size of the main window and its location on the screen. You can drag the vertical "splitter" left and right to give more or less space to each half. These geometry changes are remembered from session to session.</p>
<h2 id='Edit'>The Edit Panel</h2>
<p>The left-side panel is a typical modern plain text line-editor.
It uses a monospaced font, defaulting to
<a href="http://dejavu-fonts.org/wiki/Main_Page">Deja Vu Mono</a>
or to Courier New, either of which is legible and has a full range of Unicode characters. (The DpCustomMono2 font often used at PGDP lacks most Unicode characters.)</p>
<p>Use View&nbsp;>&nbsp;Font... command to select another font, which will be remembered from session to session. It would be a very bad idea to use anything but a monospaced font.</p>
<p>Below the edit panel is a status area where activity messages appear
from time to time. Bottom center is a line-number field displaying the
line number of the edit cursor. Type a new number in
that field and press Return to jump to a different line. Further to the
right is a progress bar that shows the status of some long-running operations.</p>
<h3>Selecting Text</h3>
<p>Select text
by dragging, or by click then shift-click, or by doubleclick (word) or 
tripleclick (line). Extend a selection by holding the shift key and
using an arrow key. PPQT does not support rectangular selections or discontinuous selections.</p>
<p>You can move text by dragging the selection, or copy text by alt-dragging; as well as by the usual copy and paste keystrokes and Edit menu commands.</p>
<h3>Edit Keys</h3>
<p>The Edit panel supports the following special keystrokes.</p>
<h4>Cursor Movement Keys</h4>
<ul>
<li>up/dn/left/right arrows move the cursor one character or line.</li>
<li>Home, also ctl-up: move to the top of text</li>
<li>End, also ctl-dn: move to the bottom of text</li>
<li>PgUp/PgDn: move one editor screen up or down</li>
<li>ctl-left and ctl-right: move to the beginning or end of the line</li>
<li>alt-left and alt-right: move one word left or right</li>
</ul>
<p>Add the shift key to any of these cursor moves to extend the selection by that amount.</p>
<h4>Editing Keys</h4>
<ul>
<li>ctl-c/ctl-x/ctl-v: copy/cut/paste</li>
<li>ctl-z: undo</li>
<li>ctl-y, also shift-ctl-z: redo</li>
<li>ctl-u, ctl-l, ctl-i: change selection to uppercase, lowercase, titlecase (Unicode-aware)</li>
</ul>
<h4>Find/Replace Keys</h4>
<p>The following keys work in conjunction with the <a href="#Find">Find panel</a>.</p>
<ul>
<li>ctl-f: display the Find panel and put the focus there</li>
<li>shift-ctl-f: copy selection to Find panel and put focus there ("find this")</li>
<li>ctl-g: repeat the last search forward (same as Find Next)</li>
<li>shift-ctl-g: repeat last search backward (same as Find Prior)</li>
<li>ctl-=: replace selection (same as Find panel replace #1)</li>
<li>ctl-t: replace selection and repeat find forward</li>
<li>shift-ctl-t: replace selection and repeat find backward</li>
</ul>
<h4>Miscellaneous Keys</h4>
<ul>
<li>ctl-hyphen: display text 1pt smaller</li>
<li>ctl-+: display text 1pt larger</li>
<li>ctl-1 through ctl-9: jump to bookmark 1-9</li>
<li>ctl-alt-1 through ctl-alt-9: set bookmark 1-9 to cursor (bookmarks
are saved in the metadata file)</li>
</ul>
<h2 id='Scannos'>Scanno Highlighting</h2>
<p>Use the File > Scannos menu command to load a file of scannos: a text file with one word per line (e.g. <tt>extras/en-common</tt>). The scannos file may be a UTF file (suffix of <tt>.utf</tt>). The same file will be re-loaded each time PPQT is restarted, if it can be found.</p>
<p>Use the View > Scannos menu command to turn on scanno highlighting. This puts a lilac background on any word that appears in the scannos file. Be patient when initiating scanno highlighting, it may tie up PPQT for several seconds in a large book.</p>
<h2 id='Spellcheck'>Spellcheck</h2>
<p>PPQT looks for a file <tt>good_words.</tt> (<tt>txt</tt> or <tt>utf</tt>) when it opens the text for the first time, and loads its contents. It looks for a file <tt>bad_words.</tt> (<tt>txt</tt> or <tt>utf</tt>)  also. These lists of "good" and "bad" words are saved in the metadata file thereafter. More "good" words can be added from the <a href='#Words'>Words panel</a>.</p>
<p>Use View&nbsp;>&nbsp;Dictionary to select a dictionary for the main language of the book. This choice of main dictionary is remembered from session to session. Dictionaries for several languages are included; more can be added by a procedure documented elsewhere. After changing the main dictionary, click Refresh in the <a href='#Words'>Words panel</a> to re-check all spelling.</p>
<p>When building or refreshing its metadata, PPQT checks all words for spelling. A "bad" word is assumed to be misspelt. A "good" word is assumed to be correct. Any word that is not in those lists is presented to the spell-checker for testing against the current dictionary.</p>
<p>Use the View&nbsp;>&nbsp;Spelling command to turn on red-underlining of misspelt words. Be patient, this may lock up PPQT for several seconds in a large book.</p>
<p>You can mark any word, phrase or section to be checked against an alternate dictionary with the nonstandard tag <b><tt>&lt;sd</tt></b>&nbsp;<i>dictag</i><b>&gt;</b>...<b><tt>&lt;/sd></tt></b>, for example<blockquote><tt>He whispered &lt;sd fr_FR>&lt;i>Je t'aime&lt;/i>&lt;/sd></tt></blockquote>Obviously these nonstandard tags must be removed before the book is finalized. The use of a single alternate dictionary does not slow spellcheck much. However, the use of two or more alternate languages may slow spellcheck a lot.
<h2 id='Pngs'>The Pngs Panel</h2>
<p>Click the Pngs tab to display the Pngs panel, which displays scan images loaded from the <tt>pngs</tt> folder. It normally displays the image that corresponds to the present edit cursor position.</p>
<p>When the focus is in the Pngs panel (click in it), ctl-hyphen zooms out and ctl-plus zooms in. The current zoom setting is remembered from session to session. If the image is larger than the panel, scroll bars appear. Use them to center the text. The scroll position is kept as pages change.</p>
<p>You can use the PgUp and PgDn keys in the Pngs panel to flip backward and forward through the scan images. However, as soon as you move the text edit cursor, the Pngs panel snaps back to the image corresponding to the cursor.</p>
<h2 id='Notes'>The Notes Panel</h2>
<p>Click the Notes tab. This panel is a simple plain-text editor to hold notes on the book in progress. Whatever contents you type here are saved
in the <tt>.meta</tt> file and reloaded with the book.</p>
<p>When the focus is in the Notes panel, the alt-ctl-L key causes the
current line number of the Edit panel cursor position to be entered, in curly braces: <tt>{1475}</tt>. (Note: under Ubuntu, alt-ctl-L may be the keyboard shortcut for Lock Screen. Use Ubuntu's Preferences &gt; Keyboard Shortcuts to change this to, e.g., shift-alt-ctl-L.)</p><p>The alt-ctl-P key causes the current scan image number to be entered in square brackets: <tt>[214]</tt>. Use these keys to relate your notes to locations in the book, for example <blockquote>
<tt>oe lig near {1475} <br />
big table on [214]</tt>.</blockquote>
</p><p>
Place the cursor in or to the right of a {nnn} line number in the notes and key ctl-L. The Edit panel cursor jumps to that line. Place the cursor in or to the right of a [ppp] page number and key ctl-p. The Edit panel cursor jumps to the top of that page's text.</p>
<p>Key ctl-f for a simple Find dialog for searching in the notes.
If text is selected, it is pre-loaded in the find-text field. The search
starts at the cursor and wraps around at the end of the notes.</p>
<h2 id='Find'>The Find Panel</h2>
<p>The Find panel has controls for search and replace, including saved searches.</p>
<p>Searching and Replacing are done within top and bottom boundaries which are initially the beginning and end of the document.</p>
<p>Upon doing any search, keyboard focus returns to the Edit panel.</p>
<h3>Find Controls</h3>
<p>The top row of five checkboxes affect the search.</p>
<table border='1' style='border-collapse:collapse;'>
<tr><td style='width:6em;'>Respect Case</td><td>When checked, search is case-sensitive.</td></tr>
<tr><td>Whole Word</td><td>When checked, normal searches only match whole words.
Does not apply to regex searches (use <tt>\b</tt> in the expression)</td></tr>
<tr><td>In Sel'n</td><td>When checked, search and replace occur within the span of text that is selected when you click the First or Last button.</td></tr>
<tr><td>Regex</td><td>When checked, the Find string is treated as a regular expression.</td></tr>
<tr><td>Greedy</td><td>When checked, a regular expression matches all it can;
otherwise as little as it can.</td></tr>
</table>
<p>The Find text field is below the checkboxes. Here enter the text pattern
to look for. At the left is a popup menu
containing the last 10 find values you explicitly typed in the field.
(These are remembered from session to session.)
The Find text field turns pink when Regex is checked and the syntax is not valid.</p>
<p>Below the text field are four buttons that perform searches:</p>
<table border='1' style='border-collapse:collapse;'>
<tr><td style='width:4em;'>Next</td><td>Search for the Find text beginning at the edit cursor and going toward the bottom boundary. Pressing Return in the Find text field is the same as clicking Next.</td></tr>
<tr><td>Prior</td><td>Search for the Find text beginning at the edit cursor and going back toward the top boundary.</td></tr>
<tr><td>First</td><td>If In Sel'n is checked, set the top and bottom of the
current selection as the search boundaries; otherwise set to the whole document.
Search for the Find text beginning at the top boundary and going forward.</td></tr>
<tr><td>Last</td><td>If In Sel'n is checked, set the top and bottom of the
current selection as the search boundaries; otherwise set to the whole document.
Search for the Find text beginning at the bottom boundary and going backward.</td></tr>
</table>
<p>To simply search forward from the cursor position, press Return while in the Find text field, or click Next. To search backward, click Prior. To search from the top, use First. To search backward from the bottom, use Last.  Search does not "wrap around" at the end of the document. When any search succeeds, the focus moves to the Edit panel.</p>
<p>When the focus is in the Edit panel, keying ctl-F makes the Find panel visible and puts the focus in it. Keying shift-ctl-F does the same but also copies the current text selection into the Find text field.</p>
<p>When the focus is in the Edit panel, keying ctl-G is the same as Next and shift-ctl-G is the same as Prior.</p>
<h3>Replace Controls</h3>
<p>There are three Replace fields. They are identical in use. Each is a text field to enter the replacement text. On the left of each field is a popup menu with the last 10 replacement strings you used out of that field.
(These are remembered from session to session.)
On the right of each field is a Repl button that causes the current edit selection to be replaced with the field contents.</p>
<p>Further right are three checkboxes. When &amp;Next is checked, use of any Repl button is followed by the effect of the Next button. When &amp;Prior is checked, use of any Repl button is followed by the effect of the Prior button.</p>
<p>When the focus is in the Edit panel, ctl-= has the effect of clicking Repl on the first replace field; ctl-t is like clicking Repl and then Next;  and shift-ctl-t is like clicking Repl and then Prior.</p>
<p>When ALL! is checked, clicking any Repl button causes all instances of the Find text within the search boundaries to be looked up and replaced. The replace-all  operation is a single undo/redo step. Before the replacement is done, a message is shown: "Replace <i>nn</i> occurrences of <i>find-text</i> with <i>repl-text</i>?" and you have the option of cancelling the operation.</p>
<p>To replace every occurrence of a string, but only within a portion of the document:</p>
<ul><li>Put the text to find in the Find text field.</li>
<li>Put the replace text in a Replace field.</li>
<li>In the Edit panel, select the span of text where replacements are to happen (for example, drag to select the Table of Contents).</li>
<li>Set the In Sel'n switch on.</li>
<li>Click First (or Last) to establish the boundaries. Also jumps to and selects the first (or last) occurrence of the string.</li>
<li>Optionally, keep clicking Next (or Prior) to step through the span of text and verify all the locations to be changed.</li>
<li>Set the ALL! checkbox on.</li>
<li>Click Repl on the appropriate Replace field.</li>
<li>Note the count of replacements in the dialog and if they look right, click OK.</li>
<li>Inspect the result and if wrong, key ctl-Z (or Edit&nbsp;>&nbsp;Undo).</li>
</ul>
<h3>User-defined Buttons</h3>
<p>Below the Replace controls is an array of 24 pushbuttons. 
Here you can store find/replace operations to be used again later.
To store an operation, right-click (Mac users: <b>control</b>-click)
a button. A message pops up asking you to give a short label for the button.
When you do so and click OK, that label is assigned to the button,
and the state of all the find/replace controls&mdash;all checkboxes
and entry fields&mdash;is stored in that button. Whenever you want to
repeat that operation, click the button. All the find/replace
controls are returned to the stored settings.
The button contents are remembered from session to session.</p>
<p>To clear the contents of a button, right-click it, clear the label field to empty, and click OK.</p>
<p>To save the button settings to a file, select File&nbsp;>&nbsp;Save Find Buttons. Provide the name and location for the saved file, which will be saved with UTF-8 encoding (so a suffix of .utf is a good idea). In the saved file each non-empty button is represented in text form. (Feel free to edit it.)</p>
<p>To load button settings from a file, select File&nbsp;>&nbsp;Load Find Buttons.
Any valid button definitions in the file are assigned to the buttons.
Rather strict controls are applied but no diagnostics are issued; an invalid
button definition is just silently ignored.</p>
<p>
The intent of saving and loading buttons is to be able to save
and re-use complex search operations, and exchange them with other
users. The format of a file of saved buttons is documented elsewhere.</p>
<h3>Regex Syntax</h3>
<p>The Regular Expression (regex) support provided by Qt4 is similar to, but has fewer features than, the Perl regexes used in guiguts. (Qt version 5, planned for 2013, has better support.) The following forms are used to match text.</p>
<table border='1' style='border-collapse:collapse;'>
<tr><td style='width:4em;'>non-special characters</td><td>match themselves</td></tr>
<tr><td><b>\</b><i>c</i></td><td>Escape for special characters: except as documented below, <b>\</b><i>c</i> matches <i>c</i>. Use <b>\\</b> to match a slash.</td></tr>
<tr><td><b>\n</b> </td><td>Matches between lines. <tt>\n\n</tt> matches an empty line.</td></tr>
<tr><td><b>\x</b><i>xxxx</i></td><td>matches Unicode character with hexadecimal value <i>xxxx</i></td></tr>
<tr><td><b>.</b> (dot)</td><td>Matches any one character <i>including newline!</i>  </td></tr>
<tr><td><b>\d</b> </td><td>  matches a decimal digit (Unicode-aware).</td></tr>
<tr><td><b>\D</b> </td><td> matches a non-digit (Unicode-aware).  </td></tr>
<tr><td><b>\s</b></td><td> matches any whitespace character <i>including newline</i> (Unicode-aware).</td></tr>
<tr><td><b>\S</b></td><td> matches a non-whitespace character (Unicode-aware) </td></tr>
<tr><td><b>\w</b></td><td> matches a word character (any Unicode letter, number, or Mark) </td></tr>
<tr><td><b>\W</b></td><td>matches anything <b>\w</b> will not.</td></tr>
<tr><td><b>\</b><i>n</i> </td><td> matches the <i>n</i>-th captured text string (same as perl/guiguts <b>$</b><i>n</i>)</td></tr>
<tr><td><b>[</b><i>chars</i><b>]</b></td><td> matches any one of the <i>chars</i>; may use ranges e.g. <tt>[A-Z1-9]</tt>    </td></tr>
<tr><td><b>[^</b><i>chars</i><b>]</td><td>  matches any character except <i>chars</i></td></tr>
<tr><td> <b>\b</b></td><td>matches the zero-width boundary between a
word and non-word character. <tt>\bon\b</tt> matches only the word "on".</td></tr>
<tr><td><b>\B</b></td><td> matches what <b>\b</b> doesn't. <tt>\Bon\B</tt> will not match the word "on" but will match inside "tone". </td></tr>
</table><p>Any of the above expressions
can be or'd with stiles: <tt>alpha|beta</tt> means alpha or beta.
Any of those expressions may be put in parentheses to capture
the matching text for use in replacements. Any expression <i>E</i> can be quantified with these suffixes:</p>
<table border='1' style='border-collapse:collapse;'>
<tr><td style='width:5em;'>  <i>E</i><b>?</b></td><td>  zero or one of <i>E</i> </td></tr>
<tr><td><i>E</i><b>+</b></td><td> one or more of <i>E</i>  </td></tr>
<tr><td> <i>E</i><b>*</b>   </td><td> zero or more of <i>E</i> </td></tr>
<tr><td> <i>E</i><b>{</b><i>n</i><b>,</b><i>m</i><b>}</b>  </td><td>from <i>n</i> to <i>m</i> of <i>E</i>, and <i>n</i> or <i>m</i> can be omitted:
<i>E</i><b>{</b><i>n</i><b>,}</b> at least <i>n</i> of <i>E</i>; <i>E</i><b>{,</b><i>m</i><b>}</b> at most <i>m</i> of <i>E</i></td></tr>
</table>
<p>Non-capturing parentheses force a match but do not capture the matching
text: <tt>(?:The color is)\s(red|green|blue)</tt> can only match a string
that begins "The color is" but the first capture, <b>\1</b>, is what 
matched <tt>(red|green|blue)</tt>.</p>
<p>Lookahead tests with <b>(?=</b><i>E</i><b>)</b> and <b>(?!</b><i>E</i><b>)</b> are supported: <tt>Fred(?=\n)</tt> 
matches "Fred" only at the end of a line; <tt>Fred(?!\n)</tt> only when
not at end of line. However the lookbehind tests of Perl regexes are not supported.</p>
<p>Note: owing to some tricks PPQT plays with the Qt regex support, 
the caret and dollar codes, which usually match at beginning and end
of a line, only match at top and bottom search boundary respectively.
Use \n to match at beginning and end of line.</p>
<p>Replacement text for a regex match may contain <b>\</b><i>n</i> to refer
to the <i>n</i>th captured (parenthesized) text. None of the special
replacements supported by guiguts (such as <tt>\U...\E</tt> to uppercase
the text) are available.</p>
<h2 id='Chars'>The Characters Panel</h2>
<p>Click the Char tab to show the Characters panel.
This panel displays a table of all characters seen in the document,
in five columns:</p>
<table border='1' style='border-collapse:collapse;width:90%'>
<tr><td><b>Glyph</b></td><td>The character symbol.</td></tr>
<tr><td><b>Value</b></td><td>The hex value of the Unicode character.</td></tr>
<tr><td><b>Count</b></td><td>The number of times the character appears in the document.</td></tr>
<tr><td><b>Entity</b></td><td>The  HTML/XML Entity code for this character.</td></tr>
<tr><td><b>Unicode<br />category</b></td><td>The Unicode category of the character.</td></tr>
</table>
<p>Click on the heading of any column to sort the table on that column.
After you have edited the document, the table is out of date.
Click the Refresh button
to rebuild all metadata and make the counts accurate.</p>
<p>In the upper right is a popup menu with three choices:<p>
<ul>
<li>All: show all characters</li>
<li> &#172; 7-bit: show only characters not in 7-bit ASCII</li>
<li> &#172; Latin-1: show only characters not in the Latin-1 set</li>
</ul>
<p>Use this menu to easily find characters that are not allowed
in a 7-bit file or a Latin-1 file, or to discover if the file needs
to be saved as UTF-8.</p>
<p>If you double-click the character glyph or value, the character 
is copied into the Find text field and the Find panel is displayed. Do this to search for the character in the document.</p>
<p>If you double-click on the Entity column, the glyph is copied to
the Find text field while the Entity code is copied to the first
Replace text. This makes it easy to replace a character with its Entity code.</p>
<h2 id='Words'>The Words Panel</h2>
<p>Click the Word tab to see the Words panel.
This is a table of all words in the document, in three columns:</p>
<ul>
<li>Word: text of the word</li>
<li>Count: the number of times the word appears</li>
<li>Features: a string of letters showing information about the word,
for example <tt>Aa---X</tt>. These codes contain, from left to right:
<ul>
<li>A if the word contains an uppercase letter, else hyphen</li>
<li>a if the word contains a lowercase letter, else hyphen</li>
<li>9 if the word contains a digit, else hyphen</li>
<li>h if the word contains a hyphen, else hyphen</li>
<li>p if the word contains an apostrophe, else hyphen</li>
<li>X if the word is in bad_words or fails spellcheck, else hyphen</li>
</ul>
</ul>
Click on any column to sort on that column. Set the Respect Case
checkbox to decide if the Word column sort is case-sensitive.</p>
<p>Double-click a word to load that word in the Find text and display
the Find panel.</p>
<p>
After the text is edited the table is out of date.
Click Refresh to rebuild all metadata
and make the table current.</p>
<p>Use the popup menu in the upper right
to filter the table to these categories:</p>
<ul>
<li>ALL: show all words</li>
<li>UPPERCASE: show only all-cap words</li>
<li>lowercase: show only lowercase words</li>
<li>mIxEdcase: show words having both upper and lowercase letters</li>
<li>Numbers: show only all-numeric words</li>
<li>Alnumeric: show words having both letters and digits</li>
<li>Hyphenated: show words containing a hyphen</li>
<li>Apostrophes: show words containing an apostrophe</li>
<li>Misspelt: show words that fail <a href='#Spellcheck'>spellcheck</a></li>
</ul>
<p>You can select one or more words by clicking, dragging, shift-clicking or
ctl-clicking in the first column. When a word or words are selected, you can key
<b>shift-</b>ctl-c to copy the selected words for pasting elsewhere.</p>
<p>Right-click (Mac users: <b>control</b>-click) on a word in the first
column to open a context menu with these options:</p>
<ul>
<li>Add to goodwords: Add all selected words to the good-words list
and show them as correctly spelled.</li>
<li>Similar words: Filter the word list to show only words that match the
clicked word when letter case, hyphens, and apostrophes are ignored.</li>
<li>First harmonic: Filter the word list to show only words that are
within one edit of difference from the clicked word.</li>
<li>Second harmonic: Show only words that are within one or two edits
of the clicked word.</li>
</ul>
<p>Use Similar words to find inconsistent use of hyphens. Use
First and Second Harmonic to find likely misspellings of a word. (For example,
use Second Harmonic on the word Footnote to find some improperly-coded
Footnote markups.)
After viewing Similar or First or Second Harmonic, select
All from the popup menu above the table to see all words again.</p>

<h2 id='Pages'>The Pages Panel</h2>
<p>Click the Page tab to display the Pages panel. 
The body of this panel is a table showing the information extracted from the page separator lines the first time the file was opened. The information is retained in the metadata even after the text of the page separator lines has been deleted. The columns are:</p>
<ul>
<li>Scan#: the number of the scanned image, usually three digits; this
is the filename of the <tt>.png</tt> image file in the <tt>pngs</tt> folder.</li>
<li>Format: the display format for a visible folio: arabic or roman numerals.</li>
<li>Action: how to compute and display the folio for this page</li>
<li>Folio: the folio (book page number) for this scanned page</li>
<li>Proofers: the PGDP user-ids who proofed this page at its various stages</li>
</ul>
<p>The table is always in scan image order. Double-click a cell in the Scan# column to make the Edit panel jump to the top of that page's text.</p>
<p>
Double-click a cell in the Action column to set the folio action to one of:</p>
<ul>
<li>Add 1: this page's folio is +1 over the preceding page's</li>
<li>Set @: set this page's folio to the number in column 4</li>
<li>Skip folio: show no visible page number for this image</li>
</ul>
<p>Double-click a number in the folio column to set a specific
numeric value to go with the Set @ action.</p>
<p>Double-click a cell in the Format column to set the format to
one of Arabic, roman (lowercase) or ROMAN (uppercase).</p>
<p>After making one or more of these changes, click the Update
button to update the table to reflect the changes. Using these
controls you can get the folios of the file to exactly match
the folios in the original book.</p>
<h3>Inserting Folio Text</h3>
<p>At the top of the panel is a text-entry field and an Insert button.
Use these to insert a text pattern at the start of every page (except
pages for which the Action is Skip folio). The text pattern may contain <tt>\n</tt> to insert a line-break, and it may contain <tt>%f</tt> to insert the
folio number for that page. Insert
any unique pattern that you can extend later with regular expression
replacements, for example <tt>[=%f=]</tt>. The full-on pattern for
HTML folios in the side margin is:</p><blockquote>
<tt>\n&lt;span class='pgnum'>&lt;a id='Page_%f' name='Page_%f'>&lt;/a>[Pg&amp;nbsp;%f]&lt;/span>\n</tt>
</blockquote>
<p>Inserting folio text is a single undo/redo operation.</p>
<h2 id='Flow'>The Reflow Panel</h2>
<p>Click the Flow tab to display the Reflow panel.
This panel has controls related to reflowing paragraphs and marked-up
sections in the ASCII etext, and for HTML conversion.
</p>
<h3>Markup Codes</h3>
<p>Use the following codes to mark sections for special treatment in the
reflow of ASCII etext and during HTML conversion. During reflow, normal paragraphs are flowed in a 75-character line. Other markup sections are
supported as follows:</p>
<table border='1' style='border-collapse:collapse;'>
<tr><th>Markup</th><th>Usage</th></tr>
<tr><td><b>/Q..Q/</b></td><td>Block Quote: paragraphs are reflowed
within left and right indents as set in the top row of controls.</td></tr>
<tr><td><b>/U..U/</b></td><td>Unsigned list: text is reflowed by paragraphs
with the first line of each paragraph indented 2 and other lines indented 4.</td></tr>
<tr><td><b>/P..P/</b></td><td>Poetry:single lines are indented as given
in the second row of controls.</td></tr>
<tr><td><b>/R..R/</b></td><td>Each line is aligned right.</td></tr>
<tr><td><b>/*..*/</b></td><td>No-flow: the entire section may be indented
by an amount specified in the third control, otherwise no change.</td></tr>
<tr><td><b>/C..C/</b></td><td>Centering: single lines are indented so
as to center on the 75-char line, with at least a 2-space indent.</td></tr>
<tr><td><b>/T..T/</b><br /><b>/TM../T</b></td>
<td>Table formatting, see discussion below</td>
<tr><td><b>/X..X/</b></td><td>Left entirely alone.</td></tr>
</table>
<h3>ASCII Reflow</h3>
<p>Select a portion of text and click Reflow Now: Selection, or 
Reflow Now: Document to reflow the whole document. Reflow is a single
undo/redo operation: perform it; inspect the result; use ctl-z to undo; adjust the markup and try again.</p>
<p>Before doing reflow you can
set the switches on the left center to skip over special sections. For example set the skip-Tables checkbox so that /T markup is treated the same as /X and  left alone. During reflow, the markup codes are retained, and you can
apply reflow multiple times without harm.</p>
<p>For Centered text, setting the "longest line+2" button adjusts
a centered section as far to the left as possible leaving a 2-space indent.
If the button is not set, each line is centered on 75 spaces, which
may produce a deep left margin.</p>
<p>Normally you reflow after removing &lt;i>, &lt;b>, and &lt;sc> markup.
However you can preview reflow while these are still in place by setting
the controls on the right center. For example if &lt;sc> markup will
be converted to uppercase, set the control to treat this markup as 0 length.
(This does not work for tables at this time. Set the skip button for tables
until you have removed the i/b/sc markup from the text.)</p>
<h4>Indents</h4>
<p>The top row of controls set the default indents for block quotes.
The <i>First</i> indent applies to the first line of a paragraph;
<i>Left</i> to the other lines. The <i>Right</i> indent causes lines to
be shorter than 75 by this amount.</p>
<p>The second row of controls set the indents for poetry, in which the <i>First</i>
indent applies to every line; the <i>Left</i> indent is used only if a line
is too long to fit in 75 chars and is folded.</p>
<p>You can specify the First, Left and/or Right indent for any section
by writing <b>F:</b><i>nn</i> <b>L:</b><i>nn</i> <b>R:</b><i>nn</i> following
the start of the markup. For example <tt>/Q F:8 L:6</tt> starts a 
block-quote markup with those margins, overriding the <i>First</i> and <i>Left</i> margins set with the visible controls, but using the <i>Right</i> from the control.</p>
<p>You can write these explicit indent values on Quote, Poetry and List markups. You can also use <b>R:</b><i>nn</i> on Right markup to set a right margin; and <b>L:</b><i>nn</i> on no-reflow (/*) markup to set a left margin.</p>
<h4>Nesting Markups</h4>
<p>To a limited degree you can nest the markups. For example you can nest
a /P poetry section within a /Q block quote section or a /U list section.
You can nest a /R right align section in poetry or a quote. Multiple
levels of nesting (/R within /P within /Q) are possible. The First, Left and Right indents for a nested section are taken relative to the indents for its containing section.</p>
<h3>Table Markup</h3>
PPQT treats tables as a special kind of reflow. You mark up the table text with <b>/T...T/</b> and some other parameters. During reflow the table is formatted. If the result is not perfect, undo, adjust the markup, try again.</p>
<p>Within a table, the column values within a row are separated in one of two ways: by strings of two or more spaces, or with stiles (|).</p>
<p>A single-line table has one table row per text line. It is marked up with  <b>/T..T/</b> Here is a simple table with two rows and two columns.</p>
<pre>/T
column 1    755.00
another row  2000.00
T/</pre><p>A multi-line table has one or more text lines per logical row,
and the rows are separated by blank lines. The markup starts with <b>/TM</b>.
Here is a multiline table, a typical table of contents:</p>
<pre>/TM
Introduction.--The Present Need   xiii

Chapter I. Applied Art    1

Chapter IV. The Nature and
Properties of Clay   29
T/
</pre>
<p>By default PPQT makes a table 75 characters wide (less
if it is nested in another markup), aligns the column text left, and spaces the
columns roughly in proportion to their contents. However, you can specify detailed controls on the opening markup line.
Specify properties of the whole table with <b>T(</b><i>properties</i><b>)</b> where the <i>properties</i> can be:</p>
<ul><li><b>W:</b><i>nn</i> for the width of the table.</li>
<li><b>S:'|'</b> (a stile in single quotes) to have the right side of the finished table be a column of
stile characters.</li>
<li><b>T:'-'</b> to have the top line of the table be a row of hyphens.</li>
</ul>
<p>For example <tt>/TM T(W:50)</tt> begins a multi-line table with a width of 50.</p>
<p>Set the default properties for all columns with <b>C(</b><i>properties</i><b>)</b>, where
the <i>properties</i> can be:</p>
<ul><li><b>W:</b><i>nn</i> for the minimum width of every column.
(PPQT will give columns more width than this to fill the table width.)</li>
<li><b>A:R/L/C/D</b> to align the cell contents left, right, centered
or decimal.</li>
<li><b>B:'-'</b> to have each cell have a line of hyphens under it.</li>
<li><b>S:'|'</b> to have the left side of each column be a column of stiles.</li>
</ul>
<p>You can set the width and alignment properties of a specific
column <i>n</i> by writing <i>n</i><b>(</b><i>properties</i><b>)</b>.
Here is a fully-specified table before reflow:</p>
<pre>/TM TABLE(TOP:'-' WIDTH:40 SIDE:'|') COL(B:'-' S:'|') 2(A:R W:12)
cell  cell   now is the time for all 
one   two    good parties to end     

row 2 cell  @  some more exciting     
                prose 
T/</pre>
<p>and after reflow:</p>
<pre>/TM TABLE(TOP:'-' WIDTH:40 SIDE:'|') COL(B:'-' S:'|') 2(A:R W:12)
----------------------------------------
|cell one |    cell two|now is the time|
|         |            |for all good   |
|         |            |parties to end |
----------------------------------------
|row 2    |           @|some more      |
|cell     |            |exciting       |
|prose    |            |               |
----------------------------------------
T/</pre>
<p>You can omit the contents of empty cells on the right end of a row. However, you cannot leave blank a cell or cells on any line within a row, or PPQT will assign
text to the wrong column (as in the example above where "prose" fell
from column 3 to column 1 because column 1 & 2 were blank).
To fill in for a cell that is logically empty,
use a single @ character on every line, as in the above example.</p>
<p>PPQT assigns horizontal space to columns using some brain-dead heuristics.
To get exactly the spacing you want, specify the width of the table and
of each column individually.</p>
<p>As suggested by the example, you can spell out the names of properties,
for example <tt>WIDTH:50</tt> instead of <tt>W:50</tt>. But actually, only
the initial letter is checked, so <tt>WATERMELON:50</tt> works, too.</p>
<p>Decimal alignment makes the decimal separators line up vertically in a column. When you specify <tt>A:D</tt> for a column, you can also specify
the width in two parts, for example <tt>W:7.3</tt> where the first number (7)
says the minimum width for the integer part, and the second (3) sets the
minimum width for the decimal and the fraction digits. You may also
specify <tt>D:'<i>x</i>'</tt> to set a different decimal separator character <i>x</i>, for example in a German text, where the comma is the conventional
decimal "point". Here is a simple table with decimal alignment before reflow:</p>
<pre>
/T TABLE(WIDTH:30) 1(A:R) 2(A:D W:8.4 D:',')
Persimmons   &euro; 24,20
Marshmallows  &euro; 124,80
T/</pre>
<p>And after:</p>
<pre>
/T TABLE(WIDTH:30) 1(A:R) 2(A:D W:8.4 D:',')
    Persimmons        &euro; 24,20 
  Marshmallows       &euro; 124,80 
T/
</pre>
<p>Decimal alignment can produce odd results when applied to cells that
contain text, especially in a multi-line table. For example you may find
it best to format a heading row manually over a decimal table.</p>
<h3>HTML Conversion</h3>
<p>ASCII reflow is designed so you can do it repeatedly. HTML conversion
is a one-shot deal: it wipes out the reflow markup lines and the spacing
of tables. Select a range of text and click HTML Convert: Selection, or
click Convert: Document to do the whole thing. HTML conversion is a single
undo/redo operation: apply it; check the result in the <a href='#View'>Preview panel</a>; key ctl-z to undo and fix the markup.</p>
<p>During conversion the following changes are made
for the different markup types.</p>
<table border='1' style='width:100%;'>
<tr><th style='width:25%;'>Markup</th><th>Converted to:</th></tr>
<tr><td>text paragraphs</td><td><tt>&lt;p></tt><i>para text</i><tt>&lt;/p></tt></td></tr>
<tr><td><b>/Q</b></td><td><tt>&lt;div class="blockquote"></tt></tr>
<tr><td>text in /Q..Q/</td><td><tt>&lt;p></tt><i>para text</i><tt>&lt;/p></tt></td></tr>
<tr><td><b>Q/</b></td><td><tt>&lt;/div></tt></tr>
<tr><td><b>/U</b></td><td><tt>&lt;ul></tt></tr>
<tr><td>text in /U..U/</td><td><tt>&lt;li></tt><i>para text</i><tt>&lt;/li></tt></td></tr>
<tr><td><b>U/</b></td><td><tt>&lt;/ul></tt></tr>
<tr><td><b>/R</b></td><td><tt>&lt;div class="ralign"></tt></tr>
<tr><td>text in /R..R/</td><td><tt>&lt;p></tt><i>each line of text</i><tt>&lt;/p></tt></td></tr>
<tr><td><b>R/</b></td><td><tt>&lt;/div></tt></tr>
<tr><td><b>/X</b>, <b>/C</b>, <b>/*</b></td><td><tt>&lt;pre></tt></td></tr>
<tr><td>text in these</td><td>not touched</td></tr>
<tr><td><b>X/</b>, <b>C/</b>, <b>*/</b></td><td><tt>&lt;/pre></tt></td></tr>
<tr><td><b>/T</b>, <b>/TM</b></td><td><tt>&lt;table></tt> or <tt>&lt;table style="width:<i>pp</i>%;"></tt> where <i>pp</i> is the specified table width/75</tt></td></tr>
<tr><td><b>T/</b></td><td><tt>&lt;/table></tt></td>
</table>
<p>Within a table, the cell values are enclosed appropriately in <tt>&lt;tr></tt> and <tt>&lt;td></tt> codes. Where a specific width was given for a column, the first row of that column is coded <tt>&lt;td style="width:<i>pp</i>%;"></tt> where
<i>pp</i> is based on the specified width divided by the table width.
When a column has right alignment or center alignment, every cell in it is 
coded with <tt>class="r"</tt> or <tt>class="c"</tt> respectively.
This assumes CSS of<pre>td.r {text-align:right}
td.c {text-align:center}</pre>
<p>Decimal alignment in a table could be coded in HTML as
<tt>&lt;td char='<i>x</i>'></tt> on each cell of a decimal column, but
this element of the HTML 4.0 standard is not supported by any browsers, so Decimal-aligned columns just default to left-alignment. Too bad.</p>
<h2 id='View'>The Preview Panel</h2>
<p>Click the Pvw tab to display the HTML Preview panel. Whenever
you click the Refresh button on this panel, the complete contents of the
Edit document are copied into this panel and displayed as HTML.
The HTML rendering is done by the open-source <a href='http://www.webkit.org'>WebKit engine</a>, the same HTML rendering code that is used by Apple's Safari and by KDE. It fully supports CSS and
standard HTML code. Java and Javascript are disabled in the Preview panel, however.</p>
<p>The base URL for image references is the base path of the book text file,
so the <tt>images</tt> folder should be located at the same place as the book text.</p>
<p>The default font is set to Palatino and the initial text font size is set to 16 points. When the focus is in the Preview panel, you can key ctl-minus and ctl-plus to zoom to smaller and larger text font sizes.</p>
<p>Key ctl-F in the Preview panel to open a simple Find dialog. Key ctl-G to search again for the found text.</p>
<h2 id='Foot'>The Footnote Panel</h2>
<p>TBS Mucho! Controls for validating and formatting footnotes.</p>
</body>
</html>
